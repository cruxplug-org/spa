{"version":3,"sources":["../src/utils/seo.ts","../src/utils/htmlFormatter.ts","../src/utils/spa.ts","../src/utils/errors.ts","../src/index.ts"],"names":["parseValue","value","defaultValue","lang","tLangAsync","resolveMetaValue","resolveKeywords","keywords","kw","resolvePageTitle","title","parsedTitle","genPageTitle","val","appName","isRTL","generateSEOMetaTags","config","baseConfig","canonicalUrl","robots","description","expertise","experience","authority","ogType","script","generateStructuredData","pageConfig","contentType","schema","line","VOID_ELEMENTS","tokenize","html","tokens","regex","match","processTokens","indentSize","indent","output","indentLevel","token","padding","tagMatch","tagName","isVoidElement","isSelfClosing","formatHTML","normalized","generateI18nMetaTag","i18nConfig","browserPath","generateSPAHTML","clientScripts","clientStyles","scriptTags","styleTags","style","i18nMetaTag","rawHTML","formatted","createSPARoute","c","getGlobalI18nConfig","setGlobalI18nConfig","buildErrorResponse","statusCode","errorPageMap","path","errorConfig","createErrorHandler","errorResponse","createDefault404Page","serverSPA","appConfig","routes","errorPageConfig","defaultErrorPage","errorHandler","app","ctx"],"mappings":"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","file":"index.cjs","sourcesContent":["// src/utils/seo.ts\r\n//\r\n// Made with â¤ï¸ by Maysara.\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PACK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    import type { SPAPageConfig, ServerSPAPluginConfig } from '../types';\r\n    import { tLangAsync } from '@minejs/server';\r\n    import { isRTL } from '@minejs/i18n';\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTIL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    /**\r\n     * Smart parser for string values\r\n     *\r\n     * Intelligently detects if a string is a translation key or plain text:\r\n     * - Translation key format (e.g., 'meta.home.title'): must contain dots, attempts translation via t(key)\r\n     * - Plain text (e.g., 'My Title', 'cruxjs', 'framework'): returns as-is\r\n     *\r\n     * Key format: MUST contain at least one dot (.) to be considered a translation key\r\n     * Examples:\r\n     *   - 'meta.home.title' â†’ translation key â†’ tries t('meta.home.title')\r\n     *   - 'cruxjs' â†’ plain text â†’ returns 'cruxjs'\r\n     *   - 'My Title' â†’ plain text â†’ returns 'My Title'\r\n     *\r\n     * @param value - The string to parse\r\n     * @param defaultValue - Fallback if value is empty\r\n     * @returns Translated value or original string\r\n     */\r\n    async function parseValue(value: string | undefined, defaultValue: string = '', lang: string = 'en'): Promise<string> {\r\n        if (!value) return defaultValue;\r\n\r\n        // Check if value looks like a translation key (e.g., 'meta.home.title')\r\n        // Key pattern: MUST contain at least one dot AND be lowercase/numeric/underscores/dots\r\n        const isTranslationKey = value.includes('.') && /^[a-z0-9._]+$/.test(value);\r\n\r\n        if (isTranslationKey) {\r\n            try {\r\n                const translated = await tLangAsync(lang, value, undefined);\r\n                // If translation returns a value, use it; otherwise fall back to original\r\n                return translated || value;\r\n            } catch {\r\n                // If translation fails, return the original value\r\n                return value;\r\n            }\r\n        }\r\n\r\n        // Not a translation key format, return as direct text\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Resolve meta tag values with smart translation detection\r\n     * Uses parseValue() to automatically detect and translate\r\n     */\r\n    async function resolveMetaValue(value: string | undefined, defaultValue: string = '', lang: string = 'en'): Promise<string> {\r\n        return await parseValue(value, defaultValue, lang);\r\n    }\r\n\r\n    /**\r\n     * Resolve keywords with smart translation detection\r\n     * Uses parseValue() on each keyword to automatically detect and translate\r\n     */\r\n    async function resolveKeywords(keywords: string[] | undefined, lang: string = 'en'): Promise<string> {\r\n        if (!keywords || keywords.length === 0) return '';\r\n\r\n        const resolved = keywords\r\n            .map(async kw => await parseValue(kw, '', lang))\r\n            .filter(Boolean);\r\n\r\n        return resolved.join(', ');\r\n    }\r\n\r\n    /**\r\n     * Generate page title with translation support\r\n     *\r\n     * Uses genPageTitle() from @minejs/i18n for RTL-aware titles\r\n     * First parses the value to detect and translate if needed\r\n     */\r\n    async function resolvePageTitle(title: string | undefined, lang: string = 'en'): Promise<string> {\r\n        if (!title) return 'Page';\r\n\r\n        // First parse the value to detect translation keys\r\n        const parsedTitle = await parseValue(title, '', lang);\r\n        // Use genPageTitle for RTL-aware title generation\r\n        try {\r\n            return genPageTitle(await parsedTitle, lang);\r\n        } catch {\r\n            // Fallback: if genPageTitle fails, use parsed value\r\n            return parsedTitle;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate page title with proper RTL handling\r\n     *\r\n     * @example\r\n     * // English: \"Profile - MyApp\"\r\n     * // Arabic: \"MyApp - Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ\"\r\n     */\r\n    export async function genPageTitle(val: string, lang: string = 'en'): Promise<string> {\r\n        const appName = await tLangAsync(lang, 'app.name', undefined);\r\n        return isRTL() ? `${appName} - ${val}` : `${val} - ${appName}`;\r\n    }\r\n\r\n\r\n    /**\r\n     * Generate SEO Meta Tags with E-E-A-T signals and translation support\r\n     *\r\n     * Includes:\r\n     * - Core SEO metadata (charset, viewport, description, keywords, robots)\r\n     * - E-E-A-T signals (expertise, experience, authority)\r\n     * - Mobile optimization (web app capable, status bar style)\r\n     * - Performance & security (prefetch, x-ua-compatible)\r\n     * - Open Graph protocol tags\r\n     * - Translation support for all meta values\r\n     */\r\n    export async function generateSEOMetaTags(\r\n        config: SPAPageConfig,\r\n        baseConfig: ServerSPAPluginConfig,\r\n        lang: string = 'en'\r\n    ): Promise<string> {\r\n        const canonicalUrl = config.canonical || `${baseConfig.baseUrl}${config.path}`;\r\n        const robots = config.robots || baseConfig.defaultRobots || 'index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1';\r\n\r\n        // Resolve translated values\r\n        const title = await resolvePageTitle(config.title, lang);\r\n        const description = await resolveMetaValue(config.description, baseConfig.defaultDescription || 'A modern single-page application', lang);\r\n        const keywords = await resolveKeywords(config.keywords || baseConfig.defaultKeywords, lang);\r\n        const expertise = await resolveMetaValue(config.expertise, '', lang);\r\n        const experience = await resolveMetaValue(config.experience, '', lang);\r\n        const authority = await resolveMetaValue(config.authority, '', lang);\r\n\r\n        // Determine OG type based on content type\r\n        const ogType = config.contentType === 'article' ? 'article' : 'website';\r\n\r\n        return `<!-- ğŸ” Core SEO Meta Tags -->\r\n                <meta charset=\"UTF-8\" />\r\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n                <title>${title}</title>\r\n                <meta name=\"description\" content=\"${description}\" />\r\n                ${keywords ? `<meta name=\"keywords\" content=\"${keywords}\" />` : ''}\r\n                <meta name=\"robots\" content=\"${robots}\" />\r\n                <meta name=\"language\" content=\"en\" />\r\n                <meta http-equiv=\"content-language\" content=\"en-us\" />\r\n                <!-- ğŸ‘¥ E-E-A-T Signals for AI Search -->\r\n                ${baseConfig.author ? `<meta name=\"author\" content=\"${baseConfig.author}\" />` : ''}\r\n                ${expertise ? `<meta name=\"expertise\" content=\"${expertise}\" />` : ''}\r\n                ${experience ? `<meta name=\"experience\" content=\"${experience}\" />` : ''}\r\n                ${authority ? `<meta name=\"authority\" content=\"${authority}\" />` : ''}\r\n                <!-- ğŸ“± Mobile & Performance -->\r\n                <meta name=\"mobile-web-app-capable\" content=\"yes\" />\r\n                <meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\r\n                <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\" />\r\n                <meta name=\"theme-color\" content=\"#000000\" />\r\n                <!-- ğŸ”— Canonical & Prefetch -->\r\n                <link rel=\"canonical\" href=\"${canonicalUrl}\" />\r\n                ${(config.clientScriptPath || baseConfig.clientScriptPath)?.map(script => `<link rel=\"prefetch\" href=\"${script}\" />`).join('\\n')}\r\n                <!-- âš¡ Performance & Security -->\r\n                <meta name=\"format-detection\" content=\"telephone=no\" />\r\n                <meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\" />\r\n                <!-- ğŸ“˜ Open Graph Protocol (Social Media) -->\r\n                <meta property=\"og:type\" content=\"${ogType}\" />\r\n                <meta property=\"og:title\" content=\"${title}\" />\r\n                <meta property=\"og:description\" content=\"${description}\" />\r\n                <meta property=\"og:url\" content=\"${canonicalUrl}\" />\r\n                <meta property=\"og:locale\" content=\"en_US\" />\r\n                ${baseConfig.author ? `<meta property=\"og:site_name\" content=\"${baseConfig.author}\" />` : ''}\r\n                ${config.ogImage ? `<meta property=\"og:image\" content=\"${config.ogImage}\" />` : ''}\r\n                ${config.ogImage ? `<meta property=\"og:image:alt\" content=\"${title}\" />` : ''}\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Generate JSON-LD Structured Data\r\n     *\r\n     * Creates schema.org compatible structured data for:\r\n     * - Rich snippets in search results\r\n     * - AI overviews and knowledge panels\r\n     * - Better indexing and SEO\r\n     *\r\n     * Supports multiple content types: WebPage, Article, Product, Service, etc.\r\n     * Handles translation keys in meta values\r\n     */\r\n    export async function generateStructuredData(\r\n        pageConfig: SPAPageConfig,\r\n        baseConfig: ServerSPAPluginConfig,\r\n        contentType: string = 'WebPage',\r\n        lang: string = 'en'\r\n    ): Promise<string> {\r\n        const canonicalUrl = pageConfig.canonical || `${baseConfig.baseUrl}${pageConfig.path}`;\r\n\r\n        // Resolve translated values for structured data\r\n        const title = await resolvePageTitle(pageConfig.title, lang);\r\n        const description = await resolveMetaValue(pageConfig.description, baseConfig.defaultDescription, lang);\r\n        const expertise = await resolveMetaValue(pageConfig.expertise, '');\r\n        const experience = await resolveMetaValue(pageConfig.experience, '');\r\n        const authority = await resolveMetaValue(pageConfig.authority, '');\r\n\r\n        const schema = {\r\n            '@context': 'https://schema.org',\r\n            '@type': contentType,\r\n            'name': title,\r\n            'url': canonicalUrl,\r\n            'description': description,\r\n            'inLanguage': 'en',\r\n            ...(pageConfig.contentType && { 'genre': pageConfig.contentType }),\r\n            ...(baseConfig.author && {\r\n                'author': {\r\n                    '@type': 'Person',\r\n                    'name': baseConfig.author,\r\n                    ...(baseConfig.authorUrl && { 'url': baseConfig.authorUrl })\r\n                }\r\n            }),\r\n            ...((await expertise || await experience || authority) && {\r\n                'creator': {\r\n                    '@type': 'Person',\r\n                    'name': baseConfig.author || 'Unknown',\r\n                    ...(expertise && { 'expertise': expertise }),\r\n                    ...(experience && { 'experience': experience }),\r\n                    ...(authority && { 'authority': authority })\r\n                }\r\n            })\r\n        };\r\n\r\n        const jsonStr = JSON.stringify(schema, null, 2)\r\n            .split('\\n')\r\n            .map(line => line ? `    ${line}` : line)\r\n            .join('\\n');\r\n        return `<script type=\"application/ld+json\">\\n${jsonStr}\\n</script>`;\r\n    }\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n","// src/utils/htmlFormatter.ts\r\n//\r\n// Made with â¤ï¸ by Maysara.\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CORE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    const VOID_ELEMENTS = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wbr'];\r\n\r\n    interface Token {\r\n        type: 'tag' | 'text' | 'comment';\r\n        value: string;\r\n    }\r\n\r\n    /**\r\n     * Tokenize HTML into tags, text, and comments\r\n     */\r\n    function tokenize(html: string): Token[] {\r\n        const tokens: Token[] = [];\r\n        const regex = /(<[^>]+>)|([^<]+)/g;\r\n        let match;\r\n\r\n        while ((match = regex.exec(html)) !== null) {\r\n            if (match[1]) {\r\n                // It's a tag\r\n                tokens.push({ type: 'tag', value: match[1] });\r\n            } else if (match[2] && match[2].trim().length > 0) {\r\n                // It's text content (not just whitespace)\r\n                tokens.push({ type: 'text', value: match[2] });\r\n            }\r\n        }\r\n\r\n        return tokens;\r\n    }\r\n\r\n    /**\r\n     * Process tokens and apply indentation\r\n     */\r\n    function processTokens(tokens: Token[], indentSize: number = 4): string[] {\r\n        const indent = ' '.repeat(indentSize);\r\n        const output: string[] = [];\r\n        let indentLevel = 0;\r\n\r\n        // eslint-disable-next-line @typescript-eslint/prefer-for-of\r\n        for (let i = 0; i < tokens.length; i++) {\r\n            const token = tokens[i];\r\n            const value = token.value.trim();\r\n\r\n            // Decrease indent for closing tags BEFORE adding\r\n            if (value.startsWith('</')) {\r\n                indentLevel = Math.max(0, indentLevel - 1);\r\n            }\r\n\r\n            const padding = indent.repeat(indentLevel);\r\n\r\n            // Skip empty text nodes\r\n            if (token.type === 'text' && value.length === 0) {\r\n                continue;\r\n            }\r\n\r\n            // Add to output\r\n            if (token.type === 'text') {\r\n                // Text nodes - check if previous line exists\r\n                if (output.length > 0 && !output[output.length - 1].trim().endsWith('>')) {\r\n                    // Append to previous line if it doesn't end with tag\r\n                    output[output.length - 1] += value;\r\n                } else {\r\n                    output.push(padding + value);\r\n                }\r\n            } else {\r\n                // Tags and comments\r\n                output.push(padding + value);\r\n            }\r\n\r\n            // Increase indent for OPENING tags ONLY (not closing, not void elements, not DOCTYPE/comments)\r\n            if (value.startsWith('<') && !value.startsWith('</')) {\r\n                // Skip DOCTYPE and comments - they don't increase indent\r\n                if (value.startsWith('<!DOCTYPE') || value.startsWith('<!--')) {\r\n                    continue;\r\n                }\r\n\r\n                // Extract tag name\r\n                const tagMatch = value.match(/<([A-Za-z][A-Za-z0-9\\\\-]*)/i);\r\n                const tagName = tagMatch ? tagMatch[1].toLowerCase() : '';\r\n\r\n                // Check if it's a void/self-closing element\r\n                const isVoidElement = VOID_ELEMENTS.includes(tagName);\r\n                const isSelfClosing = value.endsWith('/>');\r\n\r\n                // Only increase indent if it's NOT a void element AND NOT self-closing\r\n                if (!isVoidElement && !isSelfClosing) {\r\n                    indentLevel++;\r\n                }\r\n            }\r\n        }\r\n\r\n        return output;\r\n    }\r\n\r\n    /**\r\n     * Format HTML with proper indentation and cleanup\r\n     *\r\n     * - Tokenizes HTML into tags and content\r\n     * - Applies proper indentation (4 spaces per level)\r\n     * - Handles void elements correctly\r\n     * - Preserves script and style tag content\r\n     * - Maintains tag hierarchy\r\n     *\r\n     * @param html Raw HTML string\r\n     * @param indentSize Number of spaces per indent level (default: 4)\r\n     * @returns Formatted HTML with perfect indentation\r\n     */\r\n    export function formatHTML(html: string, indentSize: number = 4): string {\r\n        // Remove existing whitespace and normalize\r\n        const normalized = html\r\n            .split('\\n')\r\n            .map(line => line.trim())\r\n            .filter(line => line.length > 0)\r\n            .join('');\r\n\r\n        // Tokenize the HTML\r\n        const tokens = tokenize(normalized);\r\n\r\n        // Process tokens with indentation\r\n        const lines = processTokens(tokens, indentSize);\r\n\r\n        // Join and return\r\n        return lines.join('\\n');\r\n    }\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n","// src/utils/spa.ts\r\n//\r\n// Made with â¤ï¸ by Maysara.\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PACK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    import type { RouteDefinition, AppContext, AppConfig } from '@cruxjs/base';\r\n    import type { SPAPageConfig, ServerSPAPluginConfig } from '../types';\r\n    import { generateSEOMetaTags, generateStructuredData } from './seo';\r\n    import { formatHTML } from './htmlFormatter';\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTIL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    /**\r\n     * Generate i18n meta tag for client injection\r\n     *\r\n     * The browser.tsx template will read this meta tag and inject\r\n     * i18n config into the ClientManager config automatically.\r\n     *\r\n     * Convert server-side filesystem paths to browser-accessible URLs:\r\n     * ./src/shared/static/dist/i18n â†’ static/dist/i18n/\r\n     *\r\n     * Note: NO leading slash - i18n library needs to fetch as URL (not file path)\r\n     * Always returns a meta tag - never empty!\r\n     */\r\n    function generateI18nMetaTag(i18nConfig: AppConfig['i18n']): string {\r\n        // Provide defaults if config is missing or incomplete\r\n        const config = {\r\n            defaultLanguage: i18nConfig?.defaultLanguage || 'en',\r\n            supportedLanguages: i18nConfig?.supportedLanguages || ['en'],\r\n            basePath: i18nConfig?.basePath || 'i18n/',\r\n            fileExtension: i18nConfig?.fileExtension || 'json'\r\n        };\r\n\r\n        // Convert server-side path to browser URL\r\n        let browserPath = config.basePath;\r\n\r\n        // Convert path separators to forward slashes\r\n        browserPath = browserPath.replace(/\\\\/g, '/');\r\n\r\n        // Handle server-side paths like ./src/shared/static/dist/i18n\r\n        if (browserPath.includes('shared/static')) {\r\n            // Extract everything after \"shared/static\" and prepend static/\r\n            const afterStatic = browserPath.split('shared/static')[1] || '';\r\n            browserPath = 'static' + afterStatic;\r\n        } else if (browserPath.startsWith('./')) {\r\n            // Remove leading ./\r\n            browserPath = browserPath.slice(2);\r\n        } else if (browserPath.startsWith('/')) {\r\n            // Remove leading /\r\n            browserPath = browserPath.slice(1);\r\n        }\r\n\r\n        // Ensure it ends with /\r\n        if (!browserPath.endsWith('/')) {\r\n            browserPath += '/';\r\n        }\r\n\r\n        const i18nJson = JSON.stringify({\r\n            defaultLanguage: config.defaultLanguage,\r\n            supportedLanguages: config.supportedLanguages,\r\n            basePath: browserPath,\r\n            fileExtension: config.fileExtension\r\n        });\r\n\r\n        return `<meta name=\"app-i18n\" content='${i18nJson}' />`;\r\n    }\r\n\r\n    /**\r\n     * Generate SPA HTML shell with SEO metadata\r\n     *\r\n     * Creates a complete HTML document with:\r\n     * - SEO meta tags\r\n     * - i18n meta tag (read by browser.tsx template)\r\n     * - Structured data (JSON-LD)\r\n     * - App mount point (#app)\r\n     * - Client-side JavaScript and style entry points\r\n     *\r\n     * Output is automatically formatted with proper indentation via formatHTML()\r\n     */\r\n    export async function generateSPAHTML(\r\n        pageConfig: SPAPageConfig,\r\n        baseConfig: ServerSPAPluginConfig,\r\n        i18nConfig?: AppConfig['i18n'],\r\n        lang: string = 'en'\r\n    ): Promise<string> {\r\n        const clientScripts = pageConfig.clientScriptPath || baseConfig.clientScriptPath;\r\n        const clientStyles = pageConfig.clientStylePath || baseConfig.clientStylePath || [];\r\n\r\n        const scriptTags = clientScripts\r\n            .map(script => `<script type=\"module\" src=\"${script}\"></script>`)\r\n            .join('\\n');\r\n\r\n        const styleTags = clientStyles\r\n            .map(style => `<link rel=\"stylesheet\" href=\"${style}\" />`)\r\n            .join('\\n');\r\n\r\n        // Add i18n meta tag for browser.tsx to read\r\n        const i18nMetaTag = generateI18nMetaTag(i18nConfig);\r\n\r\n        // DEBUG: Log to see what's being generated\r\n        if (!i18nMetaTag) {\r\n            console.warn('[SPA] WARNING: i18n meta tag is empty!');\r\n        }\r\n\r\n        // Build raw HTML - GUARANTEE i18n meta tag is included!\r\n        const rawHTML = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n${await generateSEOMetaTags(pageConfig, baseConfig, lang)}\r\n${await generateStructuredData(pageConfig, baseConfig, pageConfig.contentType === 'article' ? 'Article' : 'WebPage', lang)}\r\n${i18nMetaTag}\r\n${styleTags}\r\n</head>\r\n<body>\r\n<div id=\"app\"></div>\r\n${scriptTags}\r\n</body>\r\n</html>`;\r\n\r\n        // DEBUG: Check if i18n meta tag is in raw HTML\r\n        if (!rawHTML.includes('app-i18n')) {\r\n            console.error('[SPA] ERROR: i18n meta tag NOT in raw HTML!');\r\n        }\r\n\r\n        // Format the HTML with proper indentation\r\n        const formatted = formatHTML(rawHTML);\r\n\r\n        // DEBUG: Check if i18n meta tag made it through formatting\r\n        if (!formatted.includes('app-i18n')) {\r\n            console.error('[SPA] ERROR: i18n meta tag LOST during formatting!');\r\n        }\r\n\r\n        return formatted;\r\n    }\r\n\r\n    /**\r\n     * Create SPA route definition for a page\r\n     *\r\n     * Generates a RouteDefinition that handles GET requests\r\n     * and returns the full SPA HTML shell with SEO data and i18n meta tag\r\n     */\r\n    export function createSPARoute(\r\n        pageConfig: SPAPageConfig,\r\n        baseConfig: ServerSPAPluginConfig,\r\n        i18nConfig?: AppConfig['i18n']\r\n    ): RouteDefinition {\r\n        return {\r\n            method: 'GET',\r\n            path: pageConfig.path,\r\n            handler: async (c: AppContext) => {\r\n                const html = await generateSPAHTML(pageConfig, baseConfig, i18nConfig, c.lang || 'en');\r\n                return c.html(html);\r\n            }\r\n        };\r\n    }\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// src/utils/errors.ts\r\n//\r\n// Made with â¤ï¸ by Maysara.\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PACK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    import type { ErrorPageConfig, ServerSPAPluginConfig } from '../types';\r\n    import { generateSPAHTML } from './spa';\r\n\r\n    // Get global i18n config (set by serverSPA plugin)\r\n    export function getGlobalI18nConfig() {\r\n        return (global as any).__cruxjs_i18n_config;\r\n    }\r\n\r\n    export function setGlobalI18nConfig(config: any) {\r\n        (global as any).__cruxjs_i18n_config = config;\r\n    }\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TYPE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    /**\r\n     * Error response definition\r\n     */\r\n    interface ErrorResponse {\r\n        status: number;\r\n        headers: Record<string, string>;\r\n        body: string;\r\n    }\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTIL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    /**\r\n     * Build error response with appropriate content type\r\n     *\r\n     * Returns HTML for web requests and JSON for API requests\r\n     * Automatically uses global i18n config (no need to pass it!)\r\n     */\r\n    export async function buildErrorResponse(\r\n        statusCode: number,\r\n        errorPageMap: Map<number, ErrorPageConfig>,\r\n        baseConfig: ServerSPAPluginConfig,\r\n        path: string\r\n    ): Promise<ErrorResponse> {\r\n        // API requests get JSON responses\r\n        if (path.startsWith('/api/')) {\r\n            return {\r\n                status: statusCode,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ error: `Error ${statusCode}` })\r\n            };\r\n        }\r\n\r\n        // Try to find custom error page\r\n        if (errorPageMap.has(statusCode)) {\r\n            const errorConfig = errorPageMap.get(statusCode)!;\r\n            // Use global i18n config - unified approach!\r\n            const i18nConfig = getGlobalI18nConfig();\r\n            console.log(`[Errors] Generating error page ${statusCode} with i18n:`, !!i18nConfig);\r\n            const html = await generateSPAHTML(errorConfig, baseConfig, i18nConfig);\r\n            return {\r\n                status: statusCode,\r\n                headers: { 'Content-Type': 'text/html; charset=utf-8' },\r\n                body: html\r\n            };\r\n        }\r\n\r\n        console.log(`[Errors] No custom error page for ${statusCode}, returning fallback`);\r\n        // Fallback: plain text error\r\n        return {\r\n            status: statusCode,\r\n            headers: { 'Content-Type': 'text/plain' },\r\n            body: `Error ${statusCode}`\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create error handler function for CruxJS\r\n     *\r\n     * Handles:\r\n     * - 404 Not Found pages (with auto-generation support)\r\n     * - Custom error pages by status code\r\n     * - API vs web request differentiation\r\n     * - Fallback error responses\r\n     *\r\n     * No need to pass i18nConfig - uses global!\r\n     */\r\n    export function createErrorHandler(\r\n        errorPageMap: Map<number, ErrorPageConfig>,\r\n        baseConfig: ServerSPAPluginConfig\r\n    ): (statusCode: number, path: string) => Promise<Response> {\r\n        return async (statusCode: number, path: string) => {\r\n            const errorResponse = await buildErrorResponse(statusCode, errorPageMap, baseConfig, path);\r\n            return new Response(errorResponse.body, {\r\n                status: errorResponse.status,\r\n                headers: errorResponse.headers\r\n            });\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create default 404 error page config\r\n     */\r\n    export function createDefault404Page(): ErrorPageConfig {\r\n        return {\r\n            statusCode: 404,\r\n            title: '404 - Page Not Found',\r\n            path: '/404',\r\n            description: 'The page you are looking for could not be found.',\r\n            keywords: ['404', 'not found', 'error'],\r\n            robots: 'noindex, nofollow'\r\n        };\r\n    }\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n","/* eslint-disable @typescript-eslint/no-unused-vars */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// src/index.ts\r\n//\r\n// Made with â¤ï¸ by Maysara.\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PACK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    import type {\r\n        CruxPlugin,\r\n        AppInstance\r\n    } from '@cruxjs/base';\r\n\r\n    import * as types from './types';\r\n    import { createSPARoute } from './utils/spa';\r\n    import { createErrorHandler, createDefault404Page, setGlobalI18nConfig } from './utils/errors';\r\n\r\n    export type * from './types';\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n\r\n\r\n\r\n// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CORE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\r\n\r\n    /**\r\n     * Create Server SPA Plugin\r\n     *\r\n     * Generates SPA routes with SEO/CEO metadata and structured data\r\n     * Error pages are handled via CruxJS error hooks\r\n     *\r\n     * Features:\r\n     * - Server-side rendering with full SEO support (meta tags, structured data)\r\n     * - Automatic error page handling (404, 500, etc.)\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const spaPlugin = serverSPA({\r\n     *   baseUrl            : 'https://example.com',\r\n     *   clientEntry        : './src/client/browser.tsx',\r\n     *   clientScriptPath   : ['/static/dist/js/browser.js'],\r\n     *   clientStylePath    : ['/static/dist/css/index.css'],\r\n     *   enableAutoNotFound : true,\r\n     *   pages: [\r\n     *     {\r\n     *       title          : 'Home',\r\n     *       path           : '/',\r\n     *       description    : 'Welcome to our platform'\r\n     *     }\r\n     *   ],\r\n     *   errorPages: [\r\n     *     {\r\n     *       statusCode     : 404,\r\n     *       title          : '404 - Not Found',\r\n     *       path           : '/404',\r\n     *       description    : 'Page not found'\r\n     *     }\r\n     *   ]\r\n     * });\r\n     * ```\r\n     */\r\n    export function serverSPA(config: types.ServerSPAPluginConfig, appConfig?: any): CruxPlugin & { __spaErrorHandler?: any } {\r\n        const routes = [];\r\n        const errorPageMap = new Map<number, types.ErrorPageConfig>();\r\n\r\n        // Store i18n config globally so ALL handlers can access it (unified!)\r\n        setGlobalI18nConfig(appConfig?.i18n);\r\n        const i18nConfig = appConfig?.i18n;\r\n\r\n        // Generate routes from config\r\n        if (config.pages && config.pages.length > 0) {\r\n            for (const pageConfig of config.pages) {\r\n                routes.push(createSPARoute(pageConfig, config, i18nConfig));\r\n            }\r\n        }\r\n\r\n        // Setup error pages\r\n        if (config.errorPages && config.errorPages.length > 0) {\r\n            for (const errorPageConfig of config.errorPages) {\r\n                errorPageMap.set(errorPageConfig.statusCode, errorPageConfig);\r\n                // Register error page as a regular route too (for direct access like /404)\r\n                routes.push(createSPARoute(errorPageConfig, config, i18nConfig));\r\n            }\r\n        }\r\n\r\n        // Auto-generate 404 page if enabled and not already defined\r\n        if (config.enableAutoNotFound && !errorPageMap.has(404)) {\r\n            const defaultErrorPage = createDefault404Page();\r\n            errorPageMap.set(404, defaultErrorPage);\r\n            // Also register as a regular route\r\n            routes.push(createSPARoute(defaultErrorPage, config, i18nConfig));\r\n        }\r\n\r\n        // Create error handler function (uses global i18nConfig automatically!)\r\n        const errorHandler = createErrorHandler(errorPageMap, config);\r\n\r\n        const plugin: CruxPlugin & { __spaErrorHandler?: any } = {\r\n            name: '@cruxplug/SPA',\r\n            version: '0.1.4',\r\n\r\n            routes,\r\n\r\n            // Attach error handler for CruxJS to use\r\n            __spaErrorHandler: errorHandler,\r\n\r\n            onRegister: async (app: AppInstance) => {\r\n                // console.log(`[SPA Plugin] Registered ${routes.length} SPA routes`);\r\n                if (errorPageMap.size > 0) {\r\n                    const statusCodes = Array.from(errorPageMap.keys()).join(', ');\r\n                    // console.log(`[SPA Plugin] Error pages configured for: ${statusCodes}`);\r\n                }\r\n            },\r\n\r\n            onAwake: async (ctx: any) => {\r\n                // console.log('[SPA Plugin] Awake phase - SPA routes ready');\r\n            },\r\n\r\n            onStart: async (ctx: any) => {\r\n                // console.log('[SPA Plugin] Start phase - serving SPA');\r\n            },\r\n\r\n            onReady: async (ctx: any) => {\r\n                // console.log('[SPA Plugin] Ready phase - SPA is fully operational');\r\n            }\r\n        };\r\n\r\n        return plugin;\r\n    }\r\n\r\n// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"]}